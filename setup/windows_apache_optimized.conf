# Optimized Apache Configuration for Windows XAMPP with Laravel
# This configuration is optimized for high-performance Laravel applications on Windows

# Enable mod_rewrite
LoadModule rewrite_module modules/mod_rewrite.so

# Enable mod_deflate
LoadModule deflate_module modules/mod_deflate.so

# Enable mod_expires
LoadModule expires_module modules/mod_expires.so

# Enable mod_headers
LoadModule headers_module modules/mod_headers.so

# Enable mod_ssl
LoadModule ssl_module modules/mod_ssl.so

# Enable mod_cache
LoadModule cache_module modules/mod_cache.so

# Enable mod_disk_cache
LoadModule disk_cache_module modules/mod_disk_cache.so

# Server Configuration
ServerRoot "C:/xampp/apache"
Listen 80
Listen 443

# Server Information
ServerName localhost:80
ServerAdmin admin@localhost

# Document Root
DocumentRoot "C:/xampp/htdocs"
<Directory "C:/xampp/htdocs">
    Options Indexes FollowSymLinks
    AllowOverride All
    Require all granted
</Directory>

# Laravel Application Configuration
<VirtualHost *:80>
    ServerName localhost
    DocumentRoot "C:/xampp/htdocs/nhit/public"
    
    # Security Headers
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set X-Content-Type-Options "nosniff"
    Header always set Referrer-Policy "no-referrer-when-downgrade"
    Header always set Content-Security-Policy "default-src 'self' http: https: data: blob: 'unsafe-inline'"
    
    # Enable mod_rewrite for Laravel
    RewriteEngine On
    
    # Handle Laravel routes
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^(.*)$ index.php [QSA,L]
    
    # Gzip Compression
    <Location />
        SetOutputFilter DEFLATE
        SetEnvIfNoCase Request_URI \
            \.(?:gif|jpe?g|png)$ no-gzip dont-vary
        SetEnvIfNoCase Request_URI \
            \.(?:exe|t?gz|zip|bz2|sit|rar)$ no-gzip dont-vary
    </Location>
    
    # Browser Caching
    <IfModule mod_expires.c>
        ExpiresActive On
        ExpiresByType text/css "access plus 1 year"
        ExpiresByType application/javascript "access plus 1 year"
        ExpiresByType image/png "access plus 1 year"
        ExpiresByType image/jpg "access plus 1 year"
        ExpiresByType image/jpeg "access plus 1 year"
        ExpiresByType image/gif "access plus 1 year"
        ExpiresByType image/ico "access plus 1 year"
        ExpiresByType image/icon "access plus 1 year"
        ExpiresByType text/plain "access plus 1 month"
        ExpiresByType application/pdf "access plus 1 month"
        ExpiresByType text/html "access plus 1 hour"
        ExpiresByType application/xhtml+xml "access plus 1 hour"
    </IfModule>
    
    # Cache Control Headers
    <IfModule mod_headers.c>
        <FilesMatch "\.(css|js|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$">
            Header set Cache-Control "max-age=31536000, public, immutable"
        </FilesMatch>
        <FilesMatch "\.(html|htm|php)$">
            Header set Cache-Control "max-age=3600, public"
        </FilesMatch>
    </IfModule>
    
    # Deny access to sensitive files
    <FilesMatch "^\.">
        Order allow,deny
        Deny from all
    </FilesMatch>
    
    <FilesMatch "\.(env|git|svn|hg|bzr)$">
        Order allow,deny
        Deny from all
    </FilesMatch>
    
    <FilesMatch "\.(bak|backup|old|orig|original|tmp)$">
        Order allow,deny
        Deny from all
    </FilesMatch>
    
    # Security: Block common attack patterns
    <LocationMatch "/(wp-admin|wp-login|xmlrpc)">
        Order allow,deny
        Deny from all
    </LocationMatch>
    
    # PHP Configuration
    <IfModule mod_php8.c>
        php_value memory_limit 512M
        php_value max_execution_time 300
        php_value max_input_time 300
        php_value post_max_size 100M
        php_value upload_max_filesize 100M
        php_value max_file_uploads 20
        php_value session.gc_maxlifetime 7200
        php_value opcache.enable 1
        php_value opcache.memory_consumption 256
        php_value opcache.interned_strings_buffer 16
        php_value opcache.max_accelerated_files 10000
        php_value opcache.revalidate_freq 2
        php_value opcache.fast_shutdown 1
        php_value opcache.enable_cli 1
    </IfModule>
    
    # Logging
    ErrorLog "C:/xampp/apache/logs/error.log"
    CustomLog "C:/xampp/apache/logs/access.log" combined
    
    # Performance settings
    <IfModule mod_mime.c>
        AddType application/javascript .js
        AddType text/css .css
    </IfModule>
    
    # Disable server signature
    ServerTokens Prod
    ServerSignature Off
    
    # Keep alive settings
    KeepAlive On
    KeepAliveTimeout 5
    MaxKeepAliveRequests 100
    
    # Timeout settings
    Timeout 300
    KeepAliveTimeout 5
</VirtualHost>

# SSL Configuration (Optional)
<VirtualHost *:443>
    ServerName localhost
    DocumentRoot "C:/xampp/htdocs/nhit/public"
    
    # SSL Configuration
    SSLEngine on
    SSLCertificateFile "C:/xampp/apache/conf/ssl.crt/server.crt"
    SSLCertificateKeyFile "C:/xampp/apache/conf/ssl.key/server.key"
    SSLProtocol all -SSLv3 -TLSv1 -TLSv1.1
    SSLCipherSuite ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384
    SSLHonorCipherOrder off
    SSLSessionTickets off
    
    # Security Headers
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set X-Content-Type-Options "nosniff"
    Header always set Referrer-Policy "no-referrer-when-downgrade"
    Header always set Content-Security-Policy "default-src 'self' http: https: data: blob: 'unsafe-inline'"
    Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"
    
    # Enable mod_rewrite for Laravel
    RewriteEngine On
    
    # Handle Laravel routes
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^(.*)$ index.php [QSA,L]
    
    # Gzip Compression
    <Location />
        SetOutputFilter DEFLATE
        SetEnvIfNoCase Request_URI \
            \.(?:gif|jpe?g|png)$ no-gzip dont-vary
        SetEnvIfNoCase Request_URI \
            \.(?:exe|t?gz|zip|bz2|sit|rar)$ no-gzip dont-vary
    </Location>
    
    # Browser Caching
    <IfModule mod_expires.c>
        ExpiresActive On
        ExpiresByType text/css "access plus 1 year"
        ExpiresByType application/javascript "access plus 1 year"
        ExpiresByType image/png "access plus 1 year"
        ExpiresByType image/jpg "access plus 1 year"
        ExpiresByType image/jpeg "access plus 1 year"
        ExpiresByType image/gif "access plus 1 year"
        ExpiresByType image/ico "access plus 1 year"
        ExpiresByType image/icon "access plus 1 year"
        ExpiresByType text/plain "access plus 1 month"
        ExpiresByType application/pdf "access plus 1 month"
        ExpiresByType text/html "access plus 1 hour"
        ExpiresByType application/xhtml+xml "access plus 1 hour"
    </IfModule>
    
    # Cache Control Headers
    <IfModule mod_headers.c>
        <FilesMatch "\.(css|js|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$">
            Header set Cache-Control "max-age=31536000, public, immutable"
        </FilesMatch>
        <FilesMatch "\.(html|htm|php)$">
            Header set Cache-Control "max-age=3600, public"
        </FilesMatch>
    </IfModule>
    
    # Deny access to sensitive files
    <FilesMatch "^\.">
        Order allow,deny
        Deny from all
    </FilesMatch>
    
    <FilesMatch "\.(env|git|svn|hg|bzr)$">
        Order allow,deny
        Deny from all
    </FilesMatch>
    
    <FilesMatch "\.(bak|backup|old|orig|original|tmp)$">
        Order allow,deny
        Deny from all
    </FilesMatch>
    
    # Security: Block common attack patterns
    <LocationMatch "/(wp-admin|wp-login|xmlrpc)">
        Order allow,deny
        Deny from all
    </LocationMatch>
    
    # PHP Configuration
    <IfModule mod_php8.c>
        php_value memory_limit 512M
        php_value max_execution_time 300
        php_value max_input_time 300
        php_value post_max_size 100M
        php_value upload_max_filesize 100M
        php_value max_file_uploads 20
        php_value session.gc_maxlifetime 7200
        php_value opcache.enable 1
        php_value opcache.memory_consumption 256
        php_value opcache.interned_strings_buffer 16
        php_value opcache.max_accelerated_files 10000
        php_value opcache.revalidate_freq 2
        php_value opcache.fast_shutdown 1
        php_value opcache.enable_cli 1
    </IfModule>
    
    # Logging
    ErrorLog "C:/xampp/apache/logs/ssl_error.log"
    CustomLog "C:/xampp/apache/logs/ssl_access.log" combined
    
    # Performance settings
    <IfModule mod_mime.c>
        AddType application/javascript .js
        AddType text/css .css
    </IfModule>
    
    # Disable server signature
    ServerTokens Prod
    ServerSignature Off
    
    # Keep alive settings
    KeepAlive On
    KeepAliveTimeout 5
    MaxKeepAliveRequests 100
    
    # Timeout settings
    Timeout 300
    KeepAliveTimeout 5
</VirtualHost>

# Additional Performance Settings
# Enable mod_cache for better performance
<IfModule mod_cache.c>
    CacheEnable disk /
    CacheRoot "C:/xampp/apache/cache"
    CacheDirLevels 2
    CacheDirLength 1
    CacheMaxFileSize 1000000
    CacheMinFileSize 1
    CacheIgnoreHeaders Set-Cookie
    CacheIgnoreHeaders Authorization
    CacheIgnoreHeaders WWW-Authenticate
    CacheIgnoreHeaders Cookie
    CacheIgnoreHeaders X-Forwarded-For
    CacheIgnoreHeaders X-Forwarded-Host
    CacheIgnoreHeaders X-Forwarded-Server
    CacheIgnoreHeaders X-Forwarded-User
    CacheIgnoreHeaders X-Real-IP
    CacheIgnoreHeaders X-Forwarded-Proto
    CacheIgnoreHeaders X-Forwarded-Port
    CacheIgnoreHeaders X-Forwarded-For
    CacheIgnoreHeaders X-Forwarded-Host
    CacheIgnoreHeaders X-Forwarded-Server
    CacheIgnoreHeaders X-Forwarded-User
    CacheIgnoreHeaders X-Real-IP
    CacheIgnoreHeaders X-Forwarded-Proto
    CacheIgnoreHeaders X-Forwarded-Port
</IfModule>

# Windows-specific settings
# Enable mod_rewrite
RewriteEngine On

# Windows path handling
RewriteBase /

# Windows-specific security
<Directory "C:/xampp/htdocs">
    Options -Indexes
    AllowOverride All
    Require all granted
</Directory>

# Windows-specific logging
ErrorLog "C:/xampp/apache/logs/error.log"
CustomLog "C:/xampp/apache/logs/access.log" combined

# Windows-specific performance
KeepAlive On
KeepAliveTimeout 5
MaxKeepAliveRequests 100

# Windows-specific timeout
Timeout 300
KeepAliveTimeout 5

# Windows-specific server info
ServerTokens Prod
ServerSignature Off

# Windows-specific directory permissions
<Directory "C:/xampp/htdocs">
    Options Indexes FollowSymLinks
    AllowOverride All
    Require all granted
</Directory>

# Windows-specific file handling
<FilesMatch "\.(htaccess|htpasswd|ini|log|sh|inc|bak)$">
    Order allow,deny
    Deny from all
</FilesMatch>

# Windows-specific security headers
Header always set X-Frame-Options "SAMEORIGIN"
Header always set X-XSS-Protection "1; mode=block"
Header always set X-Content-Type-Options "nosniff"
Header always set Referrer-Policy "no-referrer-when-downgrade"
Header always set Content-Security-Policy "default-src 'self' http: https: data: blob: 'unsafe-inline'"

# Windows-specific compression
<Location />
    SetOutputFilter DEFLATE
    SetEnvIfNoCase Request_URI \
        \.(?:gif|jpe?g|png)$ no-gzip dont-vary
    SetEnvIfNoCase Request_URI \
        \.(?:exe|t?gz|zip|bz2|sit|rar)$ no-gzip dont-vary
</Location>

# Windows-specific caching
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType text/css "access plus 1 year"
    ExpiresByType application/javascript "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/jpg "access plus 1 year"
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType image/ico "access plus 1 year"
    ExpiresByType image/icon "access plus 1 year"
    ExpiresByType text/plain "access plus 1 month"
    ExpiresByType application/pdf "access plus 1 month"
    ExpiresByType text/html "access plus 1 hour"
    ExpiresByType application/xhtml+xml "access plus 1 hour"
</IfModule>

# Windows-specific cache control
<IfModule mod_headers.c>
    <FilesMatch "\.(css|js|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$">
        Header set Cache-Control "max-age=31536000, public, immutable"
    </FilesMatch>
    <FilesMatch "\.(html|htm|php)$">
        Header set Cache-Control "max-age=3600, public"
    </FilesMatch>
</IfModule>
